---
title: HTTP 액션
sidebar_position: 35
description: "Convex에서 직접 HTTP API 구축하기"
---

import http from "!!raw-loader!@site/../demos/http/convex/http.ts";
import httpFunction from "!!raw-loader!@site/../private-demos/snippets/convex/httpActionExample.ts";
import Constructor from "!!raw-loader!@site/../private-demos/snippets/convex/httpActionConstructor.ts";
import httpStorage from "!!raw-loader!@site/../demos/file-storage-with-http/convex/http.ts";
import Fetch from "!!raw-loader!@site/../private-demos/snippets/src/httpAuthCall.ts";

HTTP 액션을 사용하면 Convex에서 직접 HTTP API를 구축할 수 있습니다!

```ts title="convex/http.ts"
import { httpRouter } from "convex/server";
import { httpAction } from "./_generated/server";

const http = httpRouter();

http.route({
  path: "/",
  method: "GET",
  handler: httpAction(async (ctx, request) => {
    return new Response(`Hello from ${request.url}`);
  }),
});
export default http;
```

HTTP 액션은 [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)를 따르는 [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request)를 받아 [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response)를 반환합니다. HTTP 액션은 요청과 응답을 직접 조작할 수 있으며 [쿼리](/functions/query-functions.mdx), [뮤테이션](/functions/mutation-functions.mdx) 및 [액션](/functions/actions.mdx)을 실행하여 Convex의 데이터와 간접적으로 상호 작용할 수 있습니다. HTTP 액션은 외부 애플리케이션에서 웹훅을 수신하거나 공개 HTTP API를 정의하는 데 사용될 수 있습니다.

HTTP 액션은 `https://<your deployment name>.convex.site`에 노출됩니다(예: `https://happy-animal-123.convex.site`).

**예제:**
[HTTP 액션](https://github.com/get-convex/convex-demos/tree/main/http)

## HTTP 액션 정의하기

HTTP 액션 핸들러는 일반 액션의 `action` 생성자와 유사하게 [`httpAction`](/generated-api/server#httpaction) 생성자를 사용하여 정의됩니다:

<TSAndJSSnippet
  title="convex/myHttpActions.ts"
  sourceTS={Constructor}
  sourceJS={Constructor}
/>

`handler`의 첫 번째 인수는 [`auth`](/api/interfaces/server.Auth), [`storage`](/api/interfaces/server.StorageActionWriter), [`scheduler`](/api/interfaces/server.Scheduler)와 `runQuery`, `runMutation`, `runAction`을 제공하는 [`ActionCtx`](/api/interfaces/server.GenericActionCtx) 객체입니다.

두 번째 인수에는 [`Request`](https://developer.mozilla.org/en-US/docs/Web/API/Request) 데이터가 포함됩니다. HTTP 액션은 들어오는 Request에서 인수를 파싱하는 것을 전적으로 사용자에게 맡기기 때문에 인수 검증을 지원하지 않습니다.

다음은 예제입니다:

<TSAndJSSnippet
  title="convex/messages.ts"
  sourceTS={httpFunction}
  sourceJS={httpFunction}
/>

<>
  {/* Wrapped in fragment because Prettier pushes the JSDialectFileName on new line */}
  HTTP 액션을 노출하려면 <JSDialectFileName name="convex/http.ts" /> 파일에서 [`HttpRouter`](/api/classes/server.HttpRouter)의 인스턴스를 export합니다. 인스턴스를 만들려면 `httpRouter` 함수를 호출하세요. `HttpRouter`에서 `route` 메서드를 사용하여 라우트를 노출할 수 있습니다:
</>

<TSAndJSSnippet
  title="convex/http.ts"
  sourceTS={http}
  sourceJS={http}
  snippet="router"
  highlightPatterns={["handler: postMessage"]}
/>

이제 HTTP를 통해 이 액션을 호출하고 Convex 데이터베이스에 저장된 데이터와 상호 작용할 수 있습니다. HTTP 액션은 `https://<your deployment name>.convex.site`에 노출됩니다.

```bash
export DEPLOYMENT_NAME=... # example: "happy-animal-123"
curl -d '{ "author": "User 123", "body": "Hello world" }' \
    -H 'content-type: application/json' "https://$DEPLOYMENT_NAME.convex.site/postMessage"
```

다른 Convex 함수와 마찬가지로 [대시보드](https://dashboard.convex.dev/)의 [함수 보기](/dashboard/deployments/functions.md)에서 HTTP 액션을 보고 [로그 보기](/dashboard/deployments/logs.md)에서 생성된 로그를 볼 수 있습니다.

## 제한사항

HTTP 액션은 쿼리 및 뮤테이션과 동일한 환경에서 실행되므로 Node.js 전용 JavaScript API에 액세스할 수 없습니다. HTTP 액션은 Node.js에서 실행할 수 있는 [액션](/functions/actions.mdx)을 호출할 수 있습니다.

[액션](/functions/actions.mdx#error-handling)과 마찬가지로 HTTP 액션은 부작용이 있을 수 있으며 오류가 발생했을 때 Convex에서 자동으로 재시도되지 않습니다. 오류를 처리하고 적절한 경우 요청을 재시도하는 것은 호출자의 책임입니다.

요청 및 응답 크기는 20MB로 제한됩니다.

HTTP 액션은 `.text()`, `.json()`, `.blob()`, `.arrayBuffer()`의 요청 및 응답 본문 타입을 지원합니다.

호출자를 제어하는 경우 JavaScript [`ConvexHttpClient`](/api/classes/browser.ConvexHttpClient) 또는 [Python 클라이언트](/client/python.md)를 사용하여 이러한 함수를 직접 호출할 수 있으므로 쿼리, 뮤테이션 및 액션을 HTTP로 호출하기 위해 HTTP 액션을 정의할 필요가 없습니다.

## 디버깅

### 1단계: HTTP 액션이 배포되었는지 확인합니다.

대시보드의 [함수 페이지](https://dashboard.convex.dev/deployment/functions)를 확인하고 `http`라는 항목이 있는지 확인합니다.

없는 경우 `http.js` 또는 `http.ts`라는 파일(파일 이름이 정확히 일치해야 함)에서 `httpRouter`로 HTTP 액션을 정의했는지 다시 확인하고 `npx convex dev`에 오류가 없는지 확인하세요.

### 2단계: curl을 사용하여 엔드포인트에 액세스할 수 있는지 확인합니다.

대시보드의 [설정](https://dashboard.convex.dev/deployment/settings) > URL 및 배포 키에서 URL을 가져옵니다.

이것이 **`.convex.site`**로 끝나는 URL이고 `.convex.cloud`가 아닌지 확인하세요. 예: `https://happy-animal-123.convex.site`

정의된 엔드포인트 중 하나를 치기 위해 `curl` 명령을 실행하고, 잠재적으로 테스트를 위해 특별히 새 엔드포인트를 정의합니다.

```
curl -X GET https://<deployment name>.convex.site/myEndpoint
```

대시보드의 [로그 페이지](https://dashboard.convex.dev/deployment/logs)를 확인하여 HTTP 액션에 대한 항목이 있는지 확인합니다.

### 3단계: 브라우저에서 만든 요청을 확인합니다.

HTTP 액션이 배포되었고 curl을 통해 액세스할 수 있지만 앱에서 요청하는 데 여전히 문제가 있는 경우 브라우저에서 만든 정확한 요청을 확인하세요.

브라우저의 개발자 도구에서 _네트워크_ 탭을 열고 HTTP 요청을 트리거합니다.

이 URL이 이전에 curl로 테스트한 것과 일치하는지 확인하세요 -- `.convex.site`로 끝나고 올바른 배포 이름이 있습니다.

대시보드 [로그 페이지](https://dashboard.convex.dev/deployment/logs)에서 이러한 요청을 볼 수 있어야 합니다.

브라우저 콘솔에서 "CORS error" 또는 `Access to fetch at '...' from origin '...' has been blocked by CORS policy`와 같은 메시지가 표시되는 경우 CORS 헤더를 구성하고 잠재적으로 사전 요청 `OPTIONS` 요청에 대한 핸들러를 추가해야 할 수 있습니다. 아래 [이 섹션](/functions/http-actions.mdx#cors)을 참조하세요.

## 일반적인 패턴

### 파일 스토리지

HTTP 액션을 사용하여 저장된 파일 업로드 및 가져오기를 처리할 수 있습니다. 다음을 참조하세요:

- [HTTP 액션을 통한 파일 업로드](/file-storage/upload-files.mdx#uploading-files-via-an-http-action)
- [HTTP 액션에서 파일 제공](/file-storage/serve-files.mdx#serving-files-from-http-actions)

### CORS

웹사이트에서 HTTP 액션에 요청하려면 HTTP 액션에 [Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) 헤더를 추가해야 합니다.

사용 사례에 따라 정확히 어떤 CORS 헤더가 필요한지에 대한 기존 리소스가 있습니다. [이 사이트](https://httptoolkit.com/will-it-cors/)는 추가할 CORS 헤더에 대한 대화형 안내를 제공합니다. 다음은 Convex HTTP 액션에 CORS 헤더를 추가하는 예입니다:

<TSAndJSSnippet
  title="convex/http.ts"
  sourceTS={httpStorage}
  sourceJS={httpStorage}
  snippet={["sendImageStore"]}
  highlightPatterns={["headers: new Headers", "        ", "     \\}\\)"]}
/>

다음은 사전 요청 `OPTIONS` 요청을 처리하는 예입니다:

<TSAndJSSnippet
  title="convex/http.ts"
  sourceTS={httpStorage}
  sourceJS={httpStorage}
  snippet="preflight"
  highlightPatterns={["headers: new Headers", "          ", "       \\}\\)"]}
/>

### 인증

Convex의 내장 [인증](/auth.mdx) 통합을 활용하고 [`ctx.auth.getUserIdentity()`](/api/interfaces/server.Auth#getuseridentity)에서 사용자 신원에 액세스할 수 있습니다. 이렇게 하려면 JWT 토큰을 포함하는 `Authorization` 헤더와 함께 엔드포인트를 호출합니다:

<TSAndJSSnippet sourceTS={Fetch} sourceJS={Fetch} title="myPage.ts" />
