---
title: 런타임
sidebar_position: 80
description:
  "함수를 위한 Convex 및 Node.js 런타임의 차이점 알아보기"
---

# 런타임

Convex 함수는 두 가지 런타임에서 실행될 수 있습니다:

- 기본 [Convex 런타임](#default-convex-runtime)
- 선택적 [Node.js 런타임](#nodejs-runtime)

## 기본 Convex 런타임

모든 Convex 백엔드 함수는 JavaScript 또는 TypeScript로 작성됩니다. 기본적으로 모든 함수는 [Cloudflare Workers 런타임](https://blog.cloudflare.com/cloud-computing-without-containers/)과 매우 유사한 사용자 정의 JavaScript 런타임에서 실행되며 대부분의 [웹 표준 전역 객체](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects)에 액세스할 수 있습니다.

기본 런타임에는 다음과 같은 많은 장점이 있습니다:

- **콜드 스타트 없음**. 런타임은 항상 작동하며 언제든지 함수를 처리할 준비가 되어 있습니다.
- **최신 웹 JavaScript 표준**. 런타임은 Google Chrome을 구동하는 V8을 기반으로 합니다. 이를 통해 프론트엔드 코드와 매우 유사한 인터페이스를 제공하여 코드를 더욱 단순화할 수 있습니다.
- **데이터에 대한 낮은 오버헤드 액세스**. 런타임은 쿼리 및 뮤테이션 함수를 통해 데이터에 대한 낮은 오버헤드 액세스를 갖도록 설계되어 간단한 [JavaScript 인터페이스](/database/reading-data/reading-data.mdx)를 통해 데이터베이스에 액세스할 수 있습니다.

### 지원되는 API

기본 런타임은 브라우저, [Deno](https://deno.com/) 및 [Cloudflare workers](https://developers.cloudflare.com/workers/)에서 작동하는 대부분의 npm 라이브러리를 지원합니다. 라이브러리가 지원되지 않는 경우 [Node.js 런타임](#nodejs-runtime)과 함께 액션을 사용하거나 [Discord](https://convex.dev/community)에서 문의하세요. 우리는 항상 지원을 개선하고 있습니다.

#### 네트워크 API

- [Blob](https://developer.mozilla.org/en-US/docs/Web/API/Blob)
- [Event](https://developer.mozilla.org/en-US/docs/Web/API/Event)
- [EventTarget](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget)
- [fetch](https://developer.mozilla.org/en-US/docs/Web/API/fetch) — [액션](#actions)에서만
- [File](https://developer.mozilla.org/en-US/docs/Web/API/File)
- [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData)
- [Headers](https://developer.mozilla.org/en-US/docs/Web/API/Headers)
- [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request)
- [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response)

#### 인코딩 API

- [TextDecoder](https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder)
- [TextEncoder](https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder)
- [atob](https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/atob)
- [btoa](https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/btoa)

#### 웹 스트림 API

- [ReadableStream](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream)
- [ReadableStreamBYOBReader](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamBYOBReader)
- [ReadableStreamDefaultReader](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamDefaultReader)
- [TransformStream](https://developer.mozilla.org/en-US/docs/Web/API/TransformStream)
- [WritableStream](https://developer.mozilla.org/en-US/docs/Web/API/WritableStream)
- [WritableStreamDefaultWriter](https://developer.mozilla.org/en-US/docs/Web/API/WritableStreamDefaultWriter)

#### 웹 암호화 API

- [crypto](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API)
- [CryptoKey](https://developer.mozilla.org/en-US/docs/Web/API/CryptoKey)
- [SubtleCrypto](https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto)

### 쿼리 및 뮤테이션에 대한 제한사항

쿼리 및 뮤테이션 함수는 **런타임에 의해 [결정론적](https://en.wikipedia.org/wiki/Deterministic_algorithm)이 되도록 추가로 제한됩니다**. 이를 통해 Convex가 필요에 따라 시스템에 의해 자동으로 재시도할 수 있습니다.

결정론은 함수가 몇 번을 실행되든 동일한 인수가 주어지면 동일한 부작용을 가지며 동일한 값을 반환한다는 것을 의미합니다.

Convex 함수를 작성할 때 이러한 결정론의 속성을 유지하는 것에 대해 그다지 생각할 필요가 없습니다. Convex는 진행하면서 도움이 되는 오류 메시지를 제공하므로 *실수로* 금지된 작업을 수행할 수 없습니다.

#### 쿼리 및 뮤테이션에서 무작위성 및 시간 사용하기

Convex는 함수의 결정론을 보장할 수 있도록 `Math.random()`에서 "시드된" 강력한 의사 난수 생성기를 제공합니다. 난수 생성기의 시드는 함수의 암시적 매개변수입니다. 하나의 함수 호출에서 `Math.random()`에 대한 여러 호출은 다른 난수 값을 반환합니다. Convex는 모든 함수 실행에서 JavaScript 모듈을 재평가하지 않으므로 전역 변수에 저장된 `Math.random()` 호출은 함수 실행 간에 변경되지 않습니다.

함수 내의 로직이 재현 가능하도록 하기 위해 전역적으로 사용되는 시스템 시간(모든 함수 외부)은 배포 시 "고정"되고 Convex 함수 실행 중 시스템 시간은 함수가 시작될 때 "고정"됩니다. `Date.now()`는 함수 실행 전체에 대해 동일한 결과를 반환합니다. 예를 들어:

```javascript
const globalRand = Math.random(); // `globalRand`는 실행 간에 변경되지 않습니다.
const globalNow = Date.now(); // `globalNow`는 Convex 함수가 배포된 시간입니다.

export const updateSomething = mutation({
  args: {},
  handler: () => {
    const now1 = Date.now(); // `now1`은 함수 실행이 시작된 시간입니다.
    const rand1 = Math.random(); // `rand1`은 각 함수 실행에 대해 새로운 값을 가집니다.
    // implementation
    const now2 = Date.now(); // `now2` === `now1`
    const rand2 = Math.random(); // `rand1` !== `rand2`
  },
});
```

### 액션

액션은 쿼리 및 뮤테이션 함수와 동일한 결정론 규칙에 의해 제한되지 않습니다. 특히 액션은 브라우저 표준 [`fetch`](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) 함수를 통해 타사 HTTP 엔드포인트를 호출할 수 있습니다.

기본적으로 액션도 콜드 스타트가 없고 브라우저와 유사한 API 환경을 포함한 모든 장점을 가진 Convex의 사용자 정의 JavaScript 런타임에서 실행됩니다. 또한 쿼리 및 뮤테이션 함수와 동일한 파일에 있을 수 있습니다.

## Node.js 런타임

일부 JavaScript 및 TypeScript 라이브러리는 기본 Convex 런타임에 포함되지 않은 기능을 사용합니다. Convex 액션은 액션을 포함하는 파일 상단의 `"use node"` 지시어를 통해 [Node.js](https://nodejs.org/en/about)로의 탈출구를 제공합니다. [자세히 알아보기](/functions/actions.mdx#choosing-the-runtime-use-node).

Node.js 환경의 사용은 **액션 함수로만 제한됩니다**. Node.js용으로 설계된 라이브러리를 사용하고 Convex 데이터베이스와 상호 작용하려는 경우 액션에서 Node.js 라이브러리를 호출하고 [`runQuery`](/functions/actions.mdx#action-context) 또는 [`runMutation`](/functions/actions.mdx#action-context) 헬퍼를 사용하여 쿼리 또는 뮤테이션을 호출해야 합니다.

convex 디렉토리의 모든 `.ts` 및 `.js` 파일은 가져오는 코드와 함께 기본 Convex JavaScript 런타임 또는 Node.js용으로 [번들링](/functions/bundling.mdx)됩니다.

`"use node"` 지시어가 있는 파일에는 Node.js 런타임에서 실행할 수 없으므로 Convex 쿼리 또는 뮤테이션이 포함되어서는 안 됩니다. 또한 `"use node"` 지시어가 없는 파일은 `"use node"` 지시어가 있는 파일을 가져와서는 안 됩니다. `convex/utils.ts` 파일과 같이 Convex 함수가 포함되지 않은 파일도 Node.js 전용 라이브러리를 사용하는 경우 "use node" 지시어가 필요합니다.

convex 함수를 배포할 때 `fs` / `node:fs`와 같은 Node.js 전용 import를 사용할 수 없다는 번들링 오류가 발생하는 경우 `npx convex dev --once --debug-node-apis`를 실행하면 이에 대한 자세한 정보를 얻을 수 있습니다. 더 느린 번들링 방법을 사용하여 import 체인을 추적하고 오류를 담당하는 import를 좁힙니다.

인수 크기 제한은 더 낮습니다(16MiB 대신 5MiB).

### Node.js 버전 구성

기본적으로 Node.js 환경에서 실행되는 모든 액션은 Node.js 18에서 실행됩니다. 이 버전은 [convex.json](/production/project-configuration.mdx#configuring-the-nodejs-version) 파일에서 구성할 수 있습니다. 현재 Node.js 18, 20 및 22를 지원합니다.

새 Node.js 버전을 서버에 푸시할 때 함수에 대한 새 코드가 최대 몇 분 동안 이전 Node.js 버전에서 실행될 수 있습니다.

Node.js 18은 2025년 4월 30일에 수명이 종료되었으며 2025년 9월 10일 이후에는 Convex에서 새 배포를 더 이상 지원하지 않습니다. 이 날짜 이후에 생성된 모든 프로젝트는 Node.js 20을 사용합니다. 2025년 10월 22일 이후에도 여전히 Node.js 18을 사용하는 모든 프로젝트는 자동으로 Node.js 20으로 마이그레이션됩니다.

참고: 이 구성은 자체 호스팅 Convex 백엔드를 실행할 때 지원되지 않습니다. 대신 [.nvmrc](https://github.com/get-convex/convex-backend/blob/main/.nvmrc)에 지정된 node 버전이 사용됩니다.
