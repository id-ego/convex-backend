---
title: "Vercel과 Convex 사용하기"
sidebar_label: "Vercel"
description: "Vercel에서 프론트엔드를 호스팅하고 Convex에서 백엔드를 호스팅하기"
sidebar_position: 10
---

Vercel에서 Convex 앱을 호스팅하면 코드를 푸시할 때마다 백엔드와 프론트엔드를 자동으로 재배포할 수 있습니다.

## Vercel에 배포하기

이 가이드는 Convex가 포함된 작동하는 React 앱이 이미 있다고 가정합니다. 그렇지 않은 경우 먼저 [Convex React 빠른 시작](/quickstart/react.mdx)을 따르세요. 그런 다음:

<StepByStep>
  <Step title="Vercel 계정 만들기">
    아직 만들지 않았다면 [Vercel](https://vercel.com) 계정을 만드세요. 작은 프로젝트에는 무료이며 설정하는 데 1분도 걸리지 않습니다.

    <></>

  </Step>
  <Step title="Vercel에서 프로젝트 연결하기">
    https://vercel.com/new에서 Vercel 프로젝트를 만들고 GitHub 또는 다른 Git 플랫폼의 프로젝트 소스 코드 저장소와 연결하세요.

    ![Vercel 프로젝트 가져오기](/screenshots/vercel_import.png)

  </Step>
  <Step title="Build command 재정의하기">
    "Build command"를 `npx convex deploy --cmd 'npm run build'`로 재정의하세요.

    프로젝트가 저장소의 하위 디렉토리에 있는 경우 위의 _Root Directory_도 그에 맞게 변경해야 합니다.

    ![Vercel 빌드 설정](/screenshots/vercel_build_command.png)

  </Step>

  <Step title="CONVEX_DEPLOY_KEY 환경 변수 설정하기">
    Convex 대시보드의 [프로젝트 설정](https://dashboard.convex.dev/project/settings#deploy-keys) 페이지로 이동하세요. _Generate Production Deploy Key_ 버튼을 클릭하여 **프로덕션** 배포 키를 생성하세요.
    그런 다음 복사 버튼을 클릭하여 키를 복사하세요.

    Vercel에서 _Environment Variables_를 클릭하세요.
    `CONVEX_DEPLOY_KEY`라는 이름의 환경 변수를 만들고 배포 키를 붙여넣으세요. _Environment_ 아래에서 _Production_만 체크하고 나머지는 체크 해제한 후 _Save_를 클릭하세요.

    ![Vercel 환경 변수 CONVEX_DEPLOY_KEY](/screenshots/vercel_prod_deploy_key.png)

  </Step>
  <Step title="사이트 배포하기">
    이제 _Deploy_ 버튼을 클릭하면 작업이 완료됩니다!

    <></>

  </Step>

</StepByStep>

Vercel은 배포 후 페이지에 표시되는 `https://<site-name>.vercel.app`과 같은 URL에 사이트를 자동으로 게시합니다. Git 저장소에 푸시할 때마다 Vercel은 자동으로 Convex 함수를 배포하고 사이트 변경사항을 게시합니다.

<Admonition type="info" title="커스텀 도메인을 사용하시나요?">
  Convex 함수를 제공하기 위해 커스텀 도메인을 사용하는 경우 추가 구성이 필요합니다. 자세한 내용은 [커스텀 도메인](/production/hosting/custom.mdx#hosting-with-a-custom-domain)을 참조하세요.
</Admonition>

### 작동 방식

Vercel에서 _Build Command_를 `npx convex deploy --cmd 'npm run build'`로 재정의했습니다.

`npx convex deploy`는 환경에서 `CONVEX_DEPLOY_KEY`를 읽고 이를 사용하여 `CONVEX_URL`(또는 유사한 이름) 환경 변수를 **프로덕션** 배포로 가리키도록 설정합니다.

`npm run build`에 의해 호출되는 선택한 프론트엔드 프레임워크는 `CONVEX_URL`(또는 유사한 이름) 환경 변수를 읽어 배포된 사이트(`ConvexReactClient`를 통해)를 **프로덕션** 배포로 가리킵니다.

마지막으로, `npx convex deploy`는 Convex 함수를 프로덕션 배포로 푸시합니다.

이제 프로덕션 배포에 최신 함수가 있고 앱이 이에 연결되도록 구성되었습니다.

`deploy` 명령이 추론할 수 없는 경우 `--cmd-url-env-var-name`을 사용하여 프론트엔드 코드에서 사용하는 변수 이름을 사용자 정의할 수 있습니다:

```sh
npx convex deploy --cmd-url-env-var-name CUSTOM_CONVEX_URL --cmd 'npm run build'
```

### 인증

프로덕션 URL을 허용하도록 [인증](/auth.mdx) 제공자(Clerk, Auth0 또는 기타)를 구성해야 합니다. Clerk는 `https://<site-name>.vercel.app`을 지원하지 않으므로 커스텀 도메인을 구성해야 합니다.

## 미리보기 배포

Vercel 미리보기 배포를 사용하면 병합하기 전에 앱의 변경사항을 미리 볼 수 있습니다. 프론트엔드 코드와 Convex 함수의 변경사항을 모두 미리 보려면 [Convex 미리보기 배포](/production/hosting/preview-deployments.mdx)를 설정할 수 있습니다.

이렇게 하면 각 미리보기에 대해 새로운 Convex 백엔드가 생성되고 프로덕션 및 개발 배포는 영향을 받지 않습니다.

이는 이미 위의 [Vercel에 배포하기](#deploying-to-vercel) 단계를 따랐다고 가정합니다.

<StepByStep>
  <Step title="CONVEX_DEPLOY_KEY 환경 변수 설정하기">
    [Convex 대시보드](https://dashboard.convex.dev/)에서 프로젝트의 _Settings_ 페이지로 이동하세요. _Generate Preview Deploy Key_ 버튼을 클릭하여 **미리보기** 배포 키를 생성하세요.
    그런 다음 복사 버튼을 클릭하여 키를 복사하세요.

    Vercel에서 _Environment Variables_를 클릭하세요.
    `CONVEX_DEPLOY_KEY`라는 이름의 환경 변수를 만들고 배포 키를 붙여넣으세요. _Environment_ 아래에서 _Preview_만 체크하고 나머지는 체크 해제한 후 _Save_를 클릭하세요.

    <div className="screenshot-border">
      ![Vercel 환경 변수 CONVEX_DEPLOY_KEY](/screenshots/vercel_preview_deploy_key.png)
    </div>

  </Step>
  <Step title="(선택 사항) 기본 환경 변수 설정하기">
    앱이 특정 Convex 환경 변수에 의존하는 경우, 프로젝트에서 미리보기 및 개발 배포를 위한 [기본 환경 변수](/production/environment-variables.mdx#project-environment-variable-defaults)를 설정할 수 있습니다.
    <div className="screenshot-border">
      ![프로젝트 기본 환경 변수](/screenshots/project_default_environment_variables.png)
    </div>
  </Step>

<Step title="(선택 사항) 초기 데이터를 설정하는 함수 실행하기">
  Vercel 미리보기 배포는 개발 또는 프로덕션 Convex 배포와 데이터를 공유하지 않는 새로운 Convex 백엔드에 대해 실행됩니다. `npx convex deploy` 명령에 `--preview-run 'functionName'`을 추가하여 Convex 함수를 호출하여 데이터를 설정할 수 있습니다. 이 함수는 미리보기 배포에만 실행되며 프로덕션에 배포할 때는 무시됩니다.

```sh title="Vercel > Settings > Build & Development settings > Build Command"
npx convex deploy --cmd 'npm run build' --preview-run 'functionName'
```

</Step>

  <Step title="이제 PR을 생성하고 미리보기 배포를 생성해 보세요!">

    Convex 대시보드에서 브랜치에 대한 Convex 배포를 찾을 수 있습니다.
    <div className="screenshot-border">
      ![배포 선택기의 미리보기 배포](/screenshots/preview_deployment_deployment_picker.png)
    </div>

  </Step>

</StepByStep>

### 작동 방식

미리보기 배포의 경우, `npx convex deploy`는 환경에서 `CONVEX_DEPLOY_KEY`를 읽고 이를 사용하여 Vercel 미리보기 배포의 Git 브랜치 이름과 연결된 Convex 배포를 생성합니다. 새 Convex 배포를 가리키도록 `CONVEX_URL`(또는 유사한 이름) 환경 변수를 설정합니다.

`npm run build`에 의해 호출되는 선택한 프론트엔드 프레임워크는 `CONVEX_URL` 환경 변수를 읽고 배포된 사이트(`ConvexReactClient`를 통해)를 Convex 미리보기 배포로 가리킵니다.

마지막으로, `npx convex deploy`는 Convex 함수를 미리보기 배포로 푸시하고 `--preview-run` 함수를 실행합니다(제공된 경우). 이 배포는 다른 배포와 별도의 함수, 데이터, cron 및 기타 모든 구성을 갖습니다.

`npx convex deploy`는 Vercel, Netlify, GitHub 및 GitLab 환경에 대한 Git 브랜치 이름을 추론하지만, `--preview-create` 옵션을 사용하여 새로 생성된 배포와 연결된 이름을 사용자 정의할 수 있습니다.

프로덕션 배포는 이전과 정확히 동일하게 작동합니다.
